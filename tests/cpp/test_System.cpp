#include <tl/support/string/to_string.h>
#include <usdot/utility/glot.h>
#include <tl/support/P.h>

#include <usdot/System.h>
#include "catch_main.h"
#include "usdot/utility/linspace.h"
#include <iostream>

using namespace usdot;
using namespace std;

#include <usdot/utility/gmp.h>
using namespace boost::multiprecision;
using TF = number<backends::cpp_bin_float<128>>;

// using TF = FP64;

// TEST_CASE( "System", "" ) {
//     // check_ders();
//     std::vector<TF> dv( 1000 );
//     for( PI i = 0; i < dv.size(); ++i ) {
//         TF f = -1 + 2 * TF( i ) / ( dv.size() - 1 );
//         dv[ i ] = max( 0.1, min( 1.0, 10 * ( abs( f ) - .3 ) ) );
//     }

//     // glot_vec_ys( dv );
        
//     DiffusionDensity<TF> gd( dv );

//     // glot_stream( [&]( std::ostream &fs ) {
//     //     for ( TF r : linspace<TF>( 0, 1, 10 ) ) {
//     //         gd.set_flattening_ratio( r );
//     //         gd.plot( fs, r == 0 ? "-" : "--", r == 0 || r == 1 ? 2 : 1 );
//     //     }
//     // } );

//     System<TF> si;
//     si.set_dirac_positions( cellspace<TF>( 0.0, 1.0, 10 ) );
//     si.set_global_mass_ratio( 1.0 );
//     si.set_density( &gd );

//     si.stream = &std::cout;
//     si.verbosity = 2;

//     si.solve();
//     // si.plot();
// }
// TEST_CASE( "illustration diff", "" ) {
//     // check_ders();
//     std::vector<TF> dv( 1000 );
//     for( PI i = 0; i < dv.size(); ++i ) {
//         TF f = -1 + 2 * TF( i ) / ( dv.size() - 1 );
//         dv[ i ] = max( 0.15, min( 1.0, 10 * ( abs( f ) - .3 ) ) );
//         dv[ i ] += max( -0.1, min( 0.1, sin( 14 * f ) ) );
//     }

//     // glot_vec_ys( dv );
        
//     DiffusionDensity<TF> gd( dv );

//     // glot_stream( [&]( std::ostream &fs ) {
//     //     for ( TF r : linspace<TF>( 0, 1, 14 ) ) {
//     //         gd.set_flattening_ratio( r );
//     //         gd.plot( fs, r == 0 ? "-" : "--", r == 0 || r == 1 ? 2 : 1 );
//     //     }
//     // } );

//     System<TF> si;
//     si.set_dirac_positions( cellspace<TF>( 0.0, 1.0, 10 ) );
//     si.set_global_mass_ratio( 1.0 );
//     si.set_density( &gd );
//     si.stream = &std::cout;
//     si.verbosity = 2;

//     si.initialize_with_flat_density();
//     gd.set_flattening_ratio( 1 - 1e-6 );
//     si.newton_iterations( 1e-3 );
//     std::vector<std::vector<std::array<TF,2>>> bnds;
//     std::vector<TF> ys;
//     PI cpt_y = 0;
//     for( TF d : { 0.5, 0.25, 0.125, 0.0 } ) {
//         auto w0 = si.sorted_dirac_weights;
//         auto ders = si.der_weights_wrt_flat_ratio( 2 );
//         const TF a = d - gd.current_flattening_ratio;
 
//         gd.set_flattening_ratio( d );

//         for( TF la : linspace<TF>( 0, a, 10 ) ) {
//             for( PI i = 0; i < si.nb_sorted_diracs(); ++i )
//                 si.sorted_dirac_weights[ i ] = w0[ i ] + ders[ 0 ][ i ] * la + ders[ 1 ][ i ] * pow( la, 2 ) / 2;
//             bnds.push_back( si.cell_boundaries() );
//             ys.push_back( cpt_y++ * 4 / 36.0 );
//         }
//         cpt_y--;

//         si.newton_iterations( 1 );

//     }
//     // bnds.push_back( si.cell_boundaries() );
//     // ys.push_back( cpt_y++ );
//     // si.plot_bnds_evolution( bnds );
//     P( ys );

//     std::ofstream fs( "glot.py" );
//     fs << "from matplotlib import pyplot\n";
//     for( PI i = 0; i < bnds[ 0 ].size(); ++i ) {
//         for( PI j = 0; j < bnds[ 0 ][ 0 ].size(); ++j ) {
//             std::vector<TF> xs( bnds.size() );
//             for( PI n = 0; n < bnds.size(); ++n )
//                 xs[ n ] = bnds[ n ][ i ][ j ];
//             fs << "pyplot.plot( " << to_string( xs ) << ", " << to_string( ys ) << " )\n";
//         }
//     }
//     fs << "pyplot.ylabel( 'step number (modification of t)' )\n";
//     fs << "pyplot.xlabel( 'cell boundaries' )\n";
//     fs << "pyplot.legend()\n";
//     fs << "pyplot.show()\n";
    

//     // si.solve();
//     // si.plot();
// }

// TEST_CASE( "System", "" ) {
//     // check_ders();
//     std::vector<TF> pd{ -52.2079,    -52.1916,    -52.0781,    -52.0665,    -51.9776,    -51.9258,    -51.8222,    -51.7198,     -51.639,    -51.6189,    -51.5846,     -51.461,    -51.4296,    -51.3726,    -51.3544,    -51.1796,    -51.1693,    -51.1363,    -51.1049,    -51.0441,    -51.0232,    -50.9651,    -50.9567,    -50.9525,    -50.9397,     -50.889,    -50.8774,    -50.8586,    -50.8557,    -50.8401,    -50.8379,    -50.8227,    -50.8199,    -50.8104,    -50.7294,    -50.6738,    -50.6621,     -50.558,    -50.5367,    -50.4854,    -50.4462,    -50.3622,    -50.3303,    -50.3236,    -50.3142,    -50.2597,    -50.1437,    -50.0946,    -50.0306,    -49.9982,    -49.9242,    -49.8873,    -49.8262,    -49.7095,    -49.6969,    -49.6714,    -49.6707,    -49.6688,    -49.6554,    -49.6231,    -49.6007,    -49.5994,    -49.5232,    -49.4016,    -49.3632,    -49.2947,    -49.2408,    -49.1955,    -49.1449,    -49.1007,    -48.9713,    -48.9051,    -48.8706,     -48.861,    -48.8154,    -48.8116,    -48.7912,    -48.6833,    -48.6738,    -48.6512,     -48.651,    -48.5436,    -48.5256,    -48.4449,    -48.4002,    -48.3823,     -48.368,    -48.3645,    -48.3608,      -48.32,    -48.3056,    -48.2757,    -48.2353,    -48.2134,     -48.195,    -48.0932,     -48.048,    -48.0241,     -48.009,    -47.9953,    -47.9694,     -47.939,    -47.7874,    -47.6709,    -47.6446,    -47.6165,    -47.5966,    -47.5209,    -47.4549,     -47.432,    -47.3812,    -47.3471,    -47.3292,    -47.3226,    -47.2871,    -47.2284,    -47.2035,    -47.1821,    -47.1558,    -47.1051,    -47.0097,    -46.9995,    -46.9177,    -46.8934,    -46.8606,     -46.844,    -46.8235,    -46.8179,    -46.7604,      -46.76,    -46.7506,    -46.7463,    -46.7352,    -46.6749,     -46.672,     -46.663,    -46.6515,    -46.6487,    -46.6367,    -46.3934,    -46.3863,    -46.2506,    -46.1858,     -46.095,    -46.0524,    -46.0311,    -46.0176,    -45.9822,    -45.9624,    -45.9598,    -45.9138,    -45.9102,    -45.8676,    -45.8527,    -45.8102,    -45.7572,    -45.7297,    -45.6662,     -45.665,    -45.6437,    -45.5332,    -45.5151,    -45.4635,    -45.4591,    -45.4566,    -45.3778,    -45.3295,    -45.2942,    -45.2354,     -45.211,    -45.1732,    -45.1591,    -45.0749,    -45.0388,    -45.0149,    -44.9999,    -44.9989,     -44.978,    -44.9382,    -44.8978,    -44.8549,    -44.8293,    -44.8282,     -44.786,    -44.7706,    -44.7123,    -44.6793,    -44.6542,    -44.5394,    -44.4155,    -44.4152,    -44.3153,    -44.2141,    -44.2006,    -44.1986,    -44.1307,    -44.1192,    -44.1072,    -44.1054,    -44.0953,    -44.0807,    -44.0698,    -44.0401,      -44.04,     -44.006,    -43.9983,    -43.9694,    -43.9222,    -43.8666,    -43.8365,      -43.79,    -43.7786,    -43.7587,    -43.7226,     -43.703,    -43.6879,    -43.6369,    -43.6189,    -43.5899,     -43.585,    -43.5775,    -43.5721,    -43.5318,    -43.5145,    -43.5109,    -43.4847,    -43.4178,    -43.4015,    -43.2864,    -43.2405,    -43.1996,    -43.1905,    -43.1787,    -43.1073,    -43.0904,    -43.0675,    -43.0125,    -42.8951,    -42.8451,    -42.8399,    -42.8229,    -42.8062,    -42.7851,    -42.7242,     -42.724,    -42.6996,    -42.6979,    -42.6466,    -42.6167,     -42.611,    -42.6081,    -42.6013,    -42.5833,    -42.5485,    -42.5352,    -42.5134,    -42.4551,    -42.4484,      -42.38,    -42.3779,    -42.3419,    -42.3222,     -42.267,    -42.2611,    -42.2425,    -42.2213,      -42.22,    -42.2045,    -42.1905,    -42.1899,    -42.1056,    -42.1008,    -42.0355,     -42.007,    -41.9911,    -41.9485,    -41.9416,     -41.873,    -41.8549,    -41.8319,    -41.7899,    -41.7819,     -41.752,    -41.7459,    -41.7275,    -41.7153,    -41.6897,    -41.6846,    -41.6134,    -41.5761,    -41.4636,     -41.463,    -41.3466,     -41.311,    -41.2963,     -41.236,    -41.2174,    -41.2036,    -41.1778,    -41.1771,    -41.1339,    -41.1226,    -41.0058,    -41.0028,    -40.9764,    -40.9724,    -40.9626,    -40.9619,    -40.9304,    -40.9034,    -40.8913,    -40.8539,    -40.8303,    -40.7423,     -40.708,    -40.6873,    -40.6683,    -40.6365,    -40.5885,    -40.5343,    -40.5094,    -40.4977,     -40.489,    -40.4667,    -40.4582,    -40.4389,    -40.3696,    -40.3501,    -40.3446,    -40.3165,    -40.3155,    -40.2443,    -40.2036,    -40.1528,    -40.0546,    -40.0449,    -40.0335,    -40.0322,    -40.0283,    -40.0121,    -39.9127,    -39.9075,    -39.8595,    -39.8499,    -39.8249,    -39.8213,    -39.8195,    -39.8025,    -39.7656,    -39.7425,      -39.73,    -39.6357,    -39.6161,    -39.6086,    -39.5894,    -39.5858,    -39.5847,    -39.5049,    -39.4661,    -39.4193,    -39.4046,    -39.3831,    -39.3157,    -39.3148,    -39.2666,    -39.2435,    -39.2359,    -39.1755,    -39.1494,    -39.1383,     -39.128,    -39.1067,    -39.1001,    -39.0582,    -39.0356,    -39.0204,    -38.9683,    -38.9591,    -38.9044,    -38.8768,    -38.7921,    -38.7747,    -38.7172,    -38.7163,    -38.7119,    -38.6987,    -38.6972,    -38.6749,    -38.6637,    -38.6353,    -38.6225,    -38.6111,    -38.5402,    -38.4908,    -38.4893,    -38.4753,    -38.4328,     -38.404,    -38.3597,      -38.29,    -38.2887,    -38.2004,    -38.1545,    -38.1436,    -38.1268,    -38.1125,    -38.1011,    -38.0924,    -38.0339,    -38.0331,    -38.0303,    -38.0293,    -37.9596,    -37.9571,    -37.9131,    -37.8019,    -37.7841,    -37.7623,     -37.757,    -37.7378,     -37.719,    -37.7126,    -37.6895,    -37.6539,    -37.6446,    -37.5708,    -37.5196,    -37.4546,    -37.4378,    -37.4312,    -37.4297,    -37.3698,    -37.2883,    -37.2763,    -37.2751,    -37.2354,    -37.2352,    -37.2025,    -37.1886,    -37.1816,    -37.1707,    -37.1464,    -37.1316,    -37.0402,    -37.0053,     -36.997,    -36.9726,    -36.9556,    -36.9507,    -36.9416,    -36.9192,    -36.9109,    -36.8931,    -36.8891,    -36.8235,    -36.7718,    -36.6543,    -36.6393,    -36.6175,    -36.6058,    -36.5527,    -36.5145,    -36.4387,    -36.4192,    -36.3848,     -36.367,    -36.3534,    -36.3498,     -36.283,    -36.2754,    -36.2338,    -36.1962,    -36.1876,    -36.1823,    -36.1674,     -36.156,    -36.1554,    -36.0941,    -36.0866,    -36.0855,    -36.0783,    -36.0131,    -35.9998,    -35.9605,    -35.9452,     -35.941,    -35.9339,    -35.8874,    -35.7407,    -35.6955,    -35.6884,    -35.6877,    -35.6307,    -35.6278,     -35.621,    -35.6206,    -35.5873,    -35.5859,    -35.5742,    -35.5561,    -35.5298,    -35.5164,    -35.5052,    -35.5031,    -35.4896,    -35.4696,    -35.4613,    -35.4312,     -35.424,    -35.4117,     -35.346,     -35.302,    -35.2565,    -35.2273,     -35.211,    -35.1743,    -35.1681,    -35.0712,    -35.0382,    -35.0111,    -35.0046,    -35.0031,    -34.9355,    -34.9139,    -34.8982,    -34.8656,    -34.8174,    -34.7453,    -34.7212,     -34.704,    -34.6405,    -34.6284,    -34.6088,    -34.5677,    -34.5637,    -34.5356,    -34.5278,    -34.5126,    -34.5111,    -34.4979,     -34.474,    -34.4547,    -34.4001,    -34.3965,    -34.3838,    -34.3603,    -34.3551,    -34.3533,     -34.341,    -34.3211,    -34.2988,    -34.2503,    -34.2454,    -34.2159,    -34.2154,    -34.1992,    -34.1985,     -34.197,    -34.1833,    -34.1757,    -34.1691,    -34.1612,    -34.1525,    -34.1286,    -34.0829,    -34.0228,     -34.022,    -33.9625,    -33.9552,    -33.9052,    -33.9049,    -33.8885,    -33.8195,    -33.8068,    -33.7682,    -33.7409,    -33.7326,    -33.7131,    -33.6764,    -33.6374,    -33.6222,     -33.611,    -33.5825,    -33.5802,    -33.5794,    -33.5758,    -33.5578,    -33.5546,    -33.5394,    -33.4919,    -33.4819,    -33.4704,    -33.4122,    -33.4105,    -33.3657,    -33.3574,     -33.344,    -33.3365,    -33.2984,    -33.2634,    -33.2614,    -33.2604,    -33.2584,    -33.2562,     -33.252,    -33.2208,    -33.1835,    -33.1636,     -33.155,    -33.1274,    -33.1243,    -33.1175,    -33.1107,    -33.1094,     -33.091,    -33.0769,    -33.0768,    -33.0419,      -33.04,    -33.0241,    -33.0201,    -32.9786,    -32.9573,    -32.9527,    -32.9523,    -32.9368,    -32.9251,    -32.9062,    -32.8926,     -32.888,    -32.8636,    -32.8516,    -32.8218,    -32.8161,    -32.7987,    -32.7952,    -32.7537,    -32.7325,    -32.7309,    -32.7273,    -32.7272,    -32.7122,    -32.6976,    -32.6967,    -32.6766,    -32.6277,    -32.6218,    -32.6183,     -32.601,    -32.5963,    -32.5928,    -32.5926,    -32.5871,    -32.5712,    -32.5697,    -32.5665,    -32.5409,    -32.5303,    -32.4937,    -32.4827,    -32.4511,    -32.4416,    -32.4185,    -32.4069,    -32.3583,    -32.3444,    -32.3304,    -32.3198,    -32.2964,    -32.2959,    -32.2865,    -32.2561,    -32.2237,    -32.2126,    -32.1969,    -32.1628,    -32.1605,    -32.1593,    -32.1489,    -32.1464,    -32.1406,    -32.1153,    -32.1071,    -32.0818,    -32.0731,    -32.0474,    -32.0335,    -32.0103,    -32.0021,    -31.9828,    -31.9453,    -31.9186,    -31.9144,    -31.9127,    -31.9026,    -31.8935,     -31.892,     -31.845,    -31.8137,    -31.8134,    -31.8082,    -31.7791,     -31.772,    -31.7631,     -31.735,    -31.7295,     -31.716,    -31.7143,    -31.7132,    -31.7028,    -31.6907,    -31.6873,     -31.666,    -31.6653,    -31.6625,    -31.6523,    -31.6297,    -31.6203,    -31.6026,    -31.6001,    -31.5912,    -31.5526,    -31.5236,    -31.5192,    -31.5067,    -31.5059,    -31.4896,    -31.4809,    -31.4777,    -31.4597,    -31.4241,    -31.4118,    -31.3942,     -31.359,    -31.3112,    -31.3078,    -31.3044,    -31.2967,    -31.2957,    -31.2762,    -31.2723,    -31.2456,    -31.2292,    -31.2178,    -31.2086,    -31.1966,    -31.1838,    -31.1769,     -31.165,    -31.1335,    -31.1292,    -31.1119,    -31.1068,    -31.0909,    -31.0861,    -31.0546,    -31.0449,    -31.0377,    -31.0334,     -31.026,    -31.0249,    -31.0124,    -31.0122,     -31.009,    -30.9952,    -30.9952,    -30.9714,    -30.9617,    -30.9567,     -30.952,    -30.9504,     -30.939,    -30.9285,    -30.9105,    -30.8899,    -30.8801,      -30.87,    -30.8598,    -30.8538,    -30.8534,    -30.8487,     -30.808,    -30.7585,    -30.7325,    -30.6666,    -30.6569,    -30.6513,    -30.6112,    -30.5902,    -30.5789,    -30.5709,    -30.5695,    -30.5365,    -30.5226,    -30.4642,    -30.4502,     -30.436,    -30.4096,    -30.3908,    -30.3273,    -30.3098,       -30.3,    -30.2696,    -30.2515,    -30.2457,      -30.22,    -30.2057,    -30.1861,    -30.1623,    -30.1504,    -30.1443,     -30.144,    -30.0906,    -30.0682,    -30.0461,    -30.0457,    -30.0379,    -30.0284,    -30.0088,    -29.9902,    -29.9702,    -29.9562,    -29.9556,    -29.9392,    -29.9291,    -29.9235,    -29.9171,    -29.9148,    -29.8859,     -29.856,    -29.8537,    -29.8475,    -29.8335,    -29.8008,    -29.7904,     -29.784,    -29.7396,    -29.7363,    -29.7295,    -29.7283,    -29.6942,    -29.6885,    -29.6776,    -29.6366,    -29.6208,    -29.6089,    -29.5962,    -29.5741,    -29.5296,    -29.5177,    -29.5058,    -29.4832,     -29.469,    -29.4613,    -29.4535,    -29.4493,     -29.447,    -29.4443,    -29.4367,    -29.4355,    -29.4239,    -29.3803,    -29.3785,     -29.368,    -29.3192,    -29.3146,    -29.3005,    -29.2897,     -29.267,    -29.2437,    -29.2256,    -29.2133,    -29.1711,    -29.1685,    -29.1243,    -29.0944,    -29.0931,    -29.0798,    -29.0768,    -29.0597,    -28.9957,    -28.9725,    -28.9688,    -28.9132,    -28.8776,     -28.872,    -28.8594,    -28.8485,    -28.8133,    -28.7881,    -28.7558,    -28.7332,     -28.728,    -28.6943,     -28.682,    -28.6763,    -28.6608,    -28.6605,    -28.6585,    -28.6483,    -28.6318,    -28.6233,    -28.6123,    -28.5904,    -28.5887,    -28.5758,    -28.5684,    -28.5503,     -28.526,    -28.4645,    -28.4276,    -28.4241,    -28.4226,    -28.4217,    -28.3852,    -28.3818,    -28.3781,    -28.3372,    -28.3312,    -28.3214,     -28.301,    -28.2542,     -28.224,    -28.2159,    -28.1925,    -28.1538,    -28.1516,    -28.1504,    -28.1484,    -28.1302,    -28.0954,    -28.0692,    -28.0689,    -28.0538,    -28.0269,    -28.0007,    -27.9955,     -27.985,    -27.9692,    -27.9482,    -27.9258,     -27.897,    -27.8927,    -27.8784,    -27.8207,    -27.7823,    -27.7477,     -27.736,    -27.6919,    -27.6834,    -27.6706,    -27.6694,    -27.6687,    -27.6486,     -27.641,    -27.6269,    -27.6005,    -27.5966,    -27.5946,    -27.5935,    -27.5845,    -27.5636,    -27.5544,    -27.5424,    -27.5399,    -27.5152,    -27.4747,    -27.4457,    -27.4426,    -27.4088,    -27.4037,    -27.3924,    -27.2872,    -27.2672,    -27.2639,    -27.2487,    -27.2429,    -27.2367,    -27.2108,    -27.1854,    -27.1716,    -27.1302,    -27.0692,    -27.0608,    -27.0599,     -27.009,    -26.9766,    -26.9603,    -26.9476,    -26.9463,    -26.9455,    -26.8851,     -26.885,    -26.8732,    -26.8672,     -26.849,    -26.8446,    -26.8144,    -26.8063,    -26.7806,    -26.7746,    -26.7418,    -26.7058,    -26.6898,    -26.6863,    -26.6776,    -26.6261,    -26.5918,    -26.5916,    -26.5779,    -26.5772,    -26.5763,     -26.567,    -26.5568,    -26.5497,    -26.5454,    -26.4987,    -26.4889,     -26.485,    -26.4747,    -26.4699,    -26.3937,    -26.3672,     -26.323,    -26.2904,    -26.2788,    -26.2417,    -26.2347,    -26.2341,    -26.2257,    -26.1936,     -26.186,    -26.1784,    -26.1344,    -26.1326,    -26.1203,    -26.0865,    -26.0789,    -26.0651,    -26.0388,    -26.0101,    -26.0076,    -25.9841,    -25.9762,    -25.9599,    -25.9188,    -25.8991,    -25.8513,     -25.839,    -25.8275,    -25.8233,    -25.8151,    -25.7982,    -25.7638,    -25.7624,    -25.7382,    -25.7183,      -25.71,    -25.7013,    -25.6946,    -25.6448,    -25.6282,    -25.6275,      -25.61,    -25.5981,    -25.5839,    -25.5498,    -25.5368,    -25.5137,     -25.508,    -25.5063,     -25.489,    -25.4708,    -25.4677,    -25.4115,    -25.3805,    -25.3719,    -25.3492,    -25.3448,    -25.3003,    -25.2974,    -25.2794,     -25.263,    -25.2531,    -25.1289,    -25.1242,    -25.1134,    -25.1061,    -25.0846,    -25.0789,    -25.0737,    -25.0573,    -25.0102,    -25.0078,    -24.9518,     -24.909,    -24.9057,    -24.9028,    -24.8868,    -24.8801,    -24.8527,    -24.8361,    -24.8339,    -24.8276,    -24.8083,     -24.787,    -24.7672,    -24.7334,    -24.7154,    -24.7042,    -24.6941,    -24.6901,    -24.6817,    -24.6582,    -24.6301,    -24.6159,    -24.5966,    -24.5965,     -24.593,    -24.5892,    -24.5774,    -24.5739,    -24.5436,     -24.507,    -24.4872,    -24.4748,    -24.4703,    -24.4694,    -24.4629,    -24.4449,    -24.4329,    -24.3943,    -24.3542,    -24.3379,    -24.2985,    -24.2661,    -24.2537,    -24.2186,    -24.2115,    -24.2077,    -24.1871,    -24.1738,    -24.1018,     -24.093,    -24.0825,    -24.0627,    -24.0622,    -24.0205,    -23.9985,    -23.9887,    -23.9806,    -23.9732,     -23.945,     -23.944,    -23.9383,    -23.9349,    -23.9304,    -23.9033,    -23.8744,    -23.8684,    -23.8683,    -23.7978,    -23.7761,    -23.7697,     -23.738,    -23.6993,    -23.6926,    -23.6531,    -23.6324,    -23.5869,    -23.5838,    -23.5722,    -23.5581,    -23.5571,    -23.5361,    -23.5342,    -23.4765,    -23.4593,    -23.4425,    -23.4391,    -23.4231,    -23.4209,       -23.4,    -23.3426,    -23.3046,    -23.2917,    -23.2547,    -23.2462,    -23.2382,    -23.2364,    -23.2344,    -23.2326,    -23.2302,    -23.2218,    -23.2099,    -23.1941,    -23.1685,    -23.1677,    -23.1489,    -23.1336,    -23.0987,    -23.0865,    -23.0754,    -23.0733,    -23.0617,    -23.0464,    -23.0142,         -23,    -22.9756,    -22.9706,    -22.9444,    -22.9372,    -22.9034,    -22.8701,    -22.8685,    -22.8621,    -22.8324,    -22.8215,    -22.8017,    -22.7906,    -22.7863,    -22.7596,    -22.7373,    -22.7082,    -22.7004,    -22.6886,    -22.6774,    -22.6422,    -22.6236,    -22.6039,     -22.591,    -22.5902,    -22.5733,    -22.5606,    -22.4922,    -22.4852,    -22.4774,    -22.4579,    -22.4457,    -22.4212,    -22.4113,    -22.3995,    -22.3621,    -22.3608,    -22.3566,     -22.341,     -22.329,    -22.3077,    -22.2602,    -22.2289,    -22.2153,    -22.2083,    -22.1539,    -22.1461,    -22.1282,    -22.1168,    -22.0927,    -22.0779,    -22.0752,     -22.051,    -22.0422,     -22.038,    -22.0219,    -22.0111,     -22.005,    -21.9996,    -21.9749,    -21.9667,     -21.946,    -21.9455,    -21.9423,    -21.8967,    -21.8814,     -21.878,    -21.8672,    -21.8533,    -21.8479,    -21.8433,    -21.7848,    -21.7718,     -21.727,    -21.6808,    -21.6768,    -21.6728,    -21.6644,    -21.6601,    -21.6046,    -21.5947,    -21.5919,    -21.5843,     -21.523,    -21.5155,    -21.5073,    -21.4837,    -21.4474,    -21.4332,    -21.4139,    -21.4104,    -21.4081,    -21.3636,    -21.3543,    -21.3473,    -21.3408,    -21.3112,    -21.3069,    -21.2975,    -21.2883,    -21.2814,    -21.2635,    -21.2469,    -21.2259,     -21.196,     -21.193,    -21.1761,    -21.1526,    -21.1452,    -21.1323,    -21.1211,    -21.1135,    -21.0927,    -21.0838,    -21.0608,    -21.0522,    -21.0406,    -20.9772,    -20.9593,    -20.9481,    -20.9064,    -20.8893,    -20.8818,    -20.8815,     -20.863,    -20.8583,    -20.8266,    -20.7928,    -20.7619,    -20.7355,    -20.7278,    -20.7252,    -20.7084,    -20.6898,    -20.6778,    -20.6633,    -20.6629,    -20.6529,     -20.643,    -20.6107,    -20.6078,    -20.5995,    -20.5931,    -20.5809,    -20.4758,    -20.4681,     -20.439,    -20.4017,     -20.362,    -20.3332,    -20.3329,    -20.3197,    -20.3187,     -20.305,     -20.283,     -20.256,    -20.2555,    -20.2428,    -20.2007,    -20.2003,     -20.196,    -20.1682,    -20.1346,    -20.1164,    -20.1148,    -20.0911,    -20.0585,    -20.0576,    -20.0406,    -20.0291,    -20.0157,    -19.9937,    -19.9885,     -19.987,    -19.9752,    -19.9666,    -19.9565,    -19.9562,    -19.9533,    -19.9401,    -19.9247,    -19.9123,    -19.9003,    -19.8848,    -19.8586,    -19.8158,    -19.8144,    -19.8059,    -19.7635,    -19.7559,    -19.7505,     -19.717,    -19.6601,    -19.6233,    -19.6194,    -19.5793,    -19.5434,    -19.5401,    -19.5266,    -19.5108,    -19.5089,    -19.4985,    -19.4983,    -19.4921,    -19.4797,    -19.4637,    -19.4564,    -19.4503,    -19.4496,    -19.4403,    -19.4151,    -19.3925,    -19.3293,     -19.327,    -19.3207,    -19.2704,     -19.256,    -19.2533,    -19.2518,    -19.2489,    -19.2476,    -19.2442,    -19.2404,    -19.2326,    -19.2316,    -19.2111,    -19.2106,    -19.2104,    -19.2026,    -19.1669,    -19.1633,    -19.1477,    -19.0891,    -19.0739,     -19.067,    -19.0077,     -19.004,    -18.9311,    -18.9203,    -18.9155,    -18.9095,    -18.9065,    -18.8929,    -18.8892,    -18.8856,    -18.8785,    -18.8534,    -18.8319,     -18.792,    -18.7673,    -18.7673,    -18.7667,    -18.7543,    -18.6833,     -18.649,    -18.6488,    -18.6466,    -18.6461,    -18.6422,    -18.6224,     -18.619,    -18.6053,    -18.5632,    -18.5595,    -18.5509,    -18.5372,     -18.536,    -18.5353,    -18.5308,    -18.5262,    -18.5149,    -18.5118,    -18.5024,    -18.4951,    -18.4944,    -18.4912,    -18.4902,    -18.4488,    -18.4433,    -18.4276,    -18.4162,    -18.4123,     -18.405,    -18.3958,    -18.3703,    -18.2997,    -18.2868,    -18.2865,    -18.2781,    -18.2711,    -18.2684,     -18.268,     -18.248,    -18.2349,    -18.2329,    -18.2311,    -18.2252,    -18.1978,    -18.1758,    -18.1519,    -18.1317,    -18.1235,    -18.0887,    -18.0608,    -18.0578,    -18.0524,     -18.044,    -18.0275,    -18.0196,    -17.9994,    -17.9974,    -17.9533,    -17.9491,    -17.9429,    -17.8634,    -17.8343,    -17.8331,    -17.8313,     -17.815,    -17.7969,    -17.7763,     -17.737,     -17.732,    -17.7134,    -17.6988,    -17.6544,    -17.6385,    -17.6196,    -17.6095,     -17.609,    -17.6022,    -17.5832,    -17.5544,     -17.553,     -17.528,    -17.5032,    -17.4986,    -17.4891,    -17.4867,    -17.4846,    -17.4164,    -17.4061,    -17.3967,    -17.3783,    -17.3404,    -17.3396,    -17.3296,    -17.2571,    -17.2431,    -17.2421,    -17.2288,    -17.2239,    -17.1956,    -17.1921,    -17.1883,    -17.1716,    -17.1702,    -17.1502,    -17.1382,     -17.112,     -17.111,    -17.1085,    -17.1063,    -17.1027,    -17.0902,    -17.0642,    -17.0251,    -17.0191,    -17.0033,     -17.002,    -16.9772,      -16.96,    -16.9532,    -16.9363,    -16.9267,    -16.8583,    -16.8476,    -16.8033,    -16.7826,    -16.7667,    -16.7411,    -16.7243,    -16.7037,     -16.688,    -16.6845,    -16.6658,     -16.654,    -16.6074,    -16.5856,    -16.5684,    -16.5423,    -16.5403,    -16.4865,    -16.4745,    -16.4604,    -16.4376,    -16.4229,    -16.4104,    -16.3616,    -16.3456,    -16.3161,    -16.3088,    -16.3077,    -16.2656,    -16.2587,    -16.2145,    -16.2128,    -16.1764,    -16.1576,    -16.1487,    -16.1168,    -16.1107,    -16.1078,    -16.0503,    -16.0419,    -16.0417,    -16.0369,    -16.0028,    -16.0004,    -15.9974,     -15.985,    -15.9838,    -15.9586,    -15.9122,    -15.8632,    -15.8538,    -15.8466,    -15.8171,    -15.7864,    -15.7817,    -15.7171,    -15.7142,    -15.7113,    -15.7069,    -15.6921,    -15.6813,    -15.6715,    -15.6625,    -15.6275,    -15.6257,    -15.6201,    -15.6118,    -15.5639,    -15.5337,    -15.4918,    -15.4633,    -15.4243,    -15.4153,    -15.3853,    -15.3837,    -15.3782,    -15.3655,    -15.3621,    -15.3183,    -15.3107,    -15.2675,     -15.207,    -15.1954,    -15.1737,     -15.164,    -15.1386,    -15.1301,    -15.1299,    -15.1157,    -15.0591,    -15.0479,    -15.0142,    -14.9793,    -14.9419,    -14.9037,    -14.8931,    -14.8547,    -14.8523,    -14.8485,    -14.8191,     -14.782,    -14.7793,    -14.7541,    -14.7515,    -14.7503,    -14.7353,    -14.7283,    -14.6874,    -14.6796,    -14.6682,    -14.6594,     -14.647,    -14.6205,    -14.6115,    -14.6083,      -14.59,    -14.5754,     -14.555,    -14.5465,    -14.5453,    -14.5052,    -14.4575,    -14.4282,     -14.398,    -14.3821,    -14.3785,      -14.36,    -14.3405,    -14.3066,     -14.288,    -14.2322,    -14.2239,    -14.2154,    -14.1981,    -14.1834,    -14.1576,    -14.1303,    -14.1267,    -14.1067,    -14.0354,    -14.0234,    -13.9713,    -13.9705,    -13.9677,    -13.9464,     -13.946,     -13.918,    -13.9134,    -13.9058,    -13.9022,    -13.8889,    -13.8675,    -13.8495,    -13.8031,    -13.7448,    -13.7268,    -13.6937,    -13.6504,    -13.6237,    -13.6067,    -13.5709,    -13.5648,    -13.5135,    -13.5075,    -13.4977,    -13.4376,    -13.4353,    -13.4235,     -13.422,    -13.4147,    -13.4031,    -13.3974,    -13.3888,     -13.383,    -13.3612,    -13.3225,    -13.3175,    -13.3106,    -13.2928,    -13.2787,    -13.2777,    -13.2685,    -13.2581,     -13.228,    -13.1892,    -13.1794,    -13.1748,    -13.1579,    -13.1444,    -13.1415,    -13.1316,    -13.1194,    -13.0302,    -12.9209,    -12.9109,    -12.9067,    -12.8909,    -12.8833,    -12.8467,     -12.846,    -12.7992,    -12.7841,    -12.7465,    -12.7249,    -12.6866,    -12.6863,    -12.6547,    -12.5893,    -12.5688,    -12.5195,    -12.4918,    -12.4197,    -12.4084,    -12.4005,    -12.3938,    -12.3937,    -12.3793,    -12.3671,    -12.3236,    -12.3048,    -12.2337,     -12.215,    -12.2043,    -12.2025,    -12.1952,    -12.1464,    -12.1263,    -12.1102,    -12.0612,    -12.0507,    -12.0274,    -12.0251,    -11.9966,    -11.9888,    -11.9877,    -11.9769,    -11.9676,    -11.9034,    -11.8874,    -11.8756,     -11.789,    -11.7828,    -11.7815,    -11.7726,    -11.7673,    -11.7575,    -11.7424,     -11.734,    -11.7219,    -11.7088,    -11.6992,    -11.6832,    -11.6801,    -11.6597,    -11.6495,    -11.6115,    -11.6081,    -11.5972,    -11.5871,    -11.5789,    -11.5703,    -11.5403,    -11.5313,    -11.5222,    -11.5056,    -11.5022,    -11.4936,    -11.4919,    -11.3936,    -11.3899,    -11.3758,    -11.3504,    -11.3394,    -11.3316,    -11.2844,    -11.1641,    -11.1523,    -11.0814,    -11.0676,    -10.9878,    -10.9753,    -10.8801,    -10.8717,    -10.8698,    -10.8613,    -10.8569,    -10.8465,    -10.8376,    -10.8013,    -10.7953,    -10.7808,    -10.7727,    -10.7721,    -10.7687,    -10.6938,    -10.6746,    -10.6639,    -10.6617,    -10.6373,    -10.5996,    -10.5842,    -10.5714,    -10.5706,    -10.5572,    -10.5322,    -10.5306,    -10.5111,     -10.469,    -10.4629,    -10.4419,     -10.396,    -10.3863,    -10.3742,    -10.3692,    -10.3598,    -10.3459,    -10.3253,     -10.281,     -10.248,    -10.2453,    -10.2447,    -10.2335,    -10.2321,    -10.2219,    -10.2138,    -10.1928,    -10.0764,    -10.0715,    -10.0613,    -10.0598,    -10.0387,    -9.98827,    -9.93545,    -9.92143,    -9.89367,    -9.87605,    -9.86928,    -9.86074,    -9.80956,    -9.79479,    -9.78858,    -9.74074,     -9.7307,    -9.71486,    -9.65659,    -9.63809,     -9.6042,    -9.55748,     -9.5556,    -9.54006,    -9.42535,    -9.42223,     -9.3987,    -9.38058,    -9.32596,    -9.29768,    -9.21374,    -9.19796,     -9.1805,    -9.08627,    -9.06772,    -8.99955,      -8.997,    -8.97588,    -8.97513,    -8.96983,    -8.96285,    -8.94809,    -8.92154,    -8.91799,    -8.90346,    -8.87163,    -8.86879,     -8.8662,    -8.84934,    -8.84155,    -8.80125,    -8.79059,    -8.78502,     -8.7516,    -8.70568,    -8.66356,     -8.6522,     -8.5994,    -8.54028,    -8.53803,     -8.4992,    -8.43866,    -8.42677,    -8.42163,    -8.41188,     -8.4033,    -8.40134,    -8.38293,    -8.36522,    -8.28425,    -8.26566,    -8.26242,    -8.23146,    -8.15752,    -8.14198,    -8.12554,    -8.12425,    -8.05235,    -8.03193,    -8.00444,    -7.94597,    -7.90918,    -7.87591,    -7.85652,    -7.78589,    -7.74668,    -7.72392,    -7.71598,    -7.67785,    -7.67009,    -7.66107,    -7.62163,    -7.56402,    -7.53332,    -7.49932,    -7.48231,    -7.44447,    -7.43259,    -7.43216,    -7.39593,    -7.32693,    -7.31657,    -7.29852,    -7.28027,    -7.27963,    -7.26696,    -7.26561,    -7.16907,    -7.13144,    -7.11338,    -7.06448,    -7.05766,    -7.04527,    -6.98962,    -6.96642,    -6.91054,    -6.89236,    -6.85599,    -6.82859,    -6.82285,     -6.8227,    -6.81184,    -6.80901,    -6.80249,    -6.76725,    -6.76336,     -6.7131,    -6.69412,    -6.61172,    -6.58229,    -6.57798,     -6.5603,    -6.53952,    -6.50679,     -6.4325,    -6.41678,    -6.38909,    -6.37559,    -6.34813,    -6.33541,    -6.30091,    -6.29732,    -6.28809,    -6.26494,    -6.24437,    -6.23855,    -6.16187,     -6.1148,    -6.04825,    -6.01195,    -5.99984,    -5.98309,    -5.96858,    -5.94363,    -5.93788,    -5.92077,    -5.85266,    -5.84676,    -5.82445,    -5.81665,    -5.71484,    -5.65805,    -5.65002,    -5.64946,    -5.62891,    -5.61863,    -5.61689,    -5.61176,    -5.54369,    -5.51017,    -5.48999,    -5.47013,    -5.45443,    -5.31841,    -5.27384,    -5.24081,    -5.20451,    -5.17899,    -5.17675,    -5.15193,    -5.13325,    -5.10396,    -5.09252,    -5.08815,     -5.0855,    -5.08065,    -5.07931,    -5.07492,    -5.07267,    -5.04773,    -5.04333,    -5.03601,    -5.02554,    -5.00736,    -5.00503,    -5.00385,    -4.98166,    -4.94077,    -4.88919,    -4.86968,     -4.8594,    -4.84483,    -4.84433,    -4.83866,    -4.80684,    -4.79772,    -4.79691,    -4.78798,    -4.74692,    -4.72843,     -4.7135,    -4.68198,    -4.63662,    -4.63372,    -4.62861,    -4.59964,    -4.58595,    -4.55734,    -4.49103,    -4.48685,    -4.46904,    -4.45071,    -4.44293,    -4.42595,    -4.42574,    -4.41808,    -4.39636,    -4.39224,    -4.33819,    -4.33704,     -4.3272,    -4.32623,    -4.25604,    -4.25198,     -4.1748,     -4.1549,    -4.10751,    -4.09635,    -4.07948,    -4.07804,    -4.06071,    -4.03939,    -4.02399,    -3.99489,    -3.98763,    -3.97501,    -3.92961,     -3.9155,    -3.91159,    -3.90438,     -3.8942,     -3.8768,    -3.84597,     -3.8335,    -3.82133,    -3.81377,    -3.72267,    -3.71106,    -3.69431,    -3.67983,    -3.65743,    -3.65367,    -3.63684,    -3.62328,    -3.57959,    -3.53583,      -3.524,    -3.51959,    -3.48792,    -3.47233,    -3.46669,    -3.45911,    -3.43015,    -3.39594,    -3.36793,    -3.30118,    -3.29301,    -3.24292,    -3.23743,    -3.23698,    -3.23118,    -3.22006,    -3.19814,    -3.17826,    -3.17434,    -3.14955,    -3.14579,    -3.13688,    -3.12908,    -3.12887,    -3.10133,    -3.08384,     -3.0737,    -3.06193,    -3.03864,    -2.96941,    -2.94761,    -2.92664,    -2.91123,    -2.88332,    -2.88255,    -2.87558,    -2.86645,    -2.85144,    -2.80768,     -2.8036,    -2.77642,    -2.75433,    -2.68335,    -2.67626,    -2.66356,    -2.62975,     -2.6253,    -2.56543,    -2.56301,    -2.56047,    -2.55192,    -2.55184,    -2.54485,    -2.54272,    -2.52223,    -2.49655,    -2.44868,     -2.4308,    -2.42443,    -2.40369,    -2.34581,    -2.33742,    -2.31078,    -2.29156,    -2.27689,    -2.27115,    -2.24651,    -2.21888,    -2.19899,    -2.19073,    -2.18143,    -2.17866,    -2.15088,    -2.14725,    -2.11301,     -2.0508,    -2.00352,    -1.99355,    -1.98994,    -1.97158,    -1.94788,    -1.92598,    -1.88737,    -1.85934,    -1.85144,    -1.82765,    -1.80408,     -1.7923,    -1.78919,    -1.71558,     -1.6965,    -1.69524,    -1.69223,    -1.67729,    -1.67256,    -1.66528,    -1.66447,    -1.65808,      -1.594,    -1.59138,    -1.57639,    -1.56286,    -1.55649,    -1.55106,    -1.51726,    -1.50597,    -1.48734,    -1.47667,     -1.4414,    -1.43739,    -1.40147,    -1.37696,    -1.36712,    -1.34842,    -1.31172,    -1.30496,    -1.28899,    -1.24444,    -1.23662,    -1.23121,    -1.22878,    -1.17744,    -1.15147,    -1.11181,    -1.09659,    -1.08596,    -1.08104,    -1.05444,    -1.04619,    -1.04077,    -1.00946,    -1.00576,    -1.00192,   -0.983241,   -0.982496,   -0.968531,   -0.964484,   -0.962051,   -0.955292,   -0.937122,   -0.932682,   -0.877483,   -0.870246,   -0.849666,   -0.845178,    -0.83252,   -0.826845,   -0.824289,   -0.823033,   -0.794257,   -0.792958,   -0.787504,   -0.780468,   -0.770965,   -0.763535,   -0.752557,   -0.751935,   -0.678106,   -0.633383,   -0.608413,   -0.584133,   -0.577907,   -0.554611,   -0.528631,   -0.527449,    -0.51021,   -0.459851,   -0.427905,   -0.410412,   -0.402687,   -0.392647,   -0.392639,   -0.390166,   -0.364352,   -0.338596,   -0.291522,   -0.287882,   -0.278486,   -0.263623,   -0.261359,   -0.237401,   -0.231707,   -0.197747,   -0.192549,   -0.190038,   -0.184686,    -0.17893,   -0.176163,   -0.175881,   -0.168329,   -0.163966,   -0.159178,   -0.154203,   -0.094505,  -0.0937701,  -0.0785162,  -0.0208726, -0.00469085,  0.00230247,  0.00646746,   0.0208798,   0.0230603,   0.0437372,   0.0477196,   0.0510521,   0.0697823,   0.0892349,    0.111012,    0.114652,    0.119682,    0.126375,     0.14332,    0.160455,    0.182681,    0.200751,    0.215209,    0.222049,     0.22599,    0.230048,    0.267063,    0.270488,    0.287704,    0.299725,    0.329214,    0.354348,    0.356629,    0.362302,    0.365486,     0.37012,    0.373374,    0.374148,    0.379893,    0.393206,    0.400635,    0.411645,    0.451042,    0.468276,    0.470744,    0.486921,    0.494995,    0.514552,    0.520491,    0.534381,    0.534963,    0.577507,     0.58115,    0.587555,    0.611231,    0.617402,    0.642688,    0.648462,    0.649923,    0.653534,    0.654169,    0.672976,    0.676973,    0.682721,    0.702288,    0.706243,     0.71573,    0.740999,    0.748943,    0.777009,    0.792618,    0.794179,    0.805559,    0.810265,     0.81177,    0.820703,    0.822574,     0.82299,    0.828115,    0.857583,    0.869351,    0.872665,    0.885755,     0.89068,    0.896086,    0.898948,    0.899479,    0.914921,    0.919947,    0.942365,    0.945949,    0.952791,    0.964849,    0.965074,    0.969368,     1.01165,     1.01857,     1.03085,     1.03446,     1.03505,     1.03817,     1.06426,     1.09165,     1.10385,     1.10867,     1.10925,     1.17387,     1.19695,     1.20833,     1.21434,      1.2338,       1.239,     1.24751,     1.25211,     1.25459,     1.26471,     1.27601,     1.27884,     1.29174,     1.31982,     1.32334,     1.33087,     1.33228,     1.35201,     1.35339,     1.37554,     1.38854,     1.39317,     1.39388,     1.41878,     1.43198,     1.43751,     1.43994,     1.44345,     1.46235,     1.46669,     1.48861,      1.4973,     1.50423,     1.51091,     1.51623,     1.52114,     1.52726,     1.52825,     1.54573,     1.57944,     1.59318,     1.60024,     1.60951,     1.65976,     1.66569,      1.6722,      1.6989,      1.7014,     1.70522,     1.71259,     1.71573,     1.73472,     1.74392,     1.75034,     1.76154,     1.77432,     1.78072,     1.78133,     1.78295,     1.79006,     1.80358,     1.81338,     1.81379,     1.82406,     1.82913,     1.87577,     1.90958,     1.91861,     1.94013,     1.97139,     1.98011,     1.99206,     1.99367,     2.03724,     2.06427,     2.08407,     2.14062,     2.15644,     2.15724,     2.16826,     2.17325,     2.18904,      2.1898,     2.19848,     2.21236,     2.23179,     2.26593,     2.28177,     2.28372,     2.29904,     2.30719,     2.32878,     2.33761,     2.33838,     2.37571,     2.37891,     2.38336,     2.38537,     2.38939,     2.39979,     2.42152,     2.44955,     2.47532,     2.48855,     2.48937,     2.51519,     2.51823,     2.54364,     2.55831,     2.57083,     2.60884,     2.62906,     2.64049,     2.64735,     2.65359,     2.65455,     2.65655,      2.6567,     2.66401,     2.66725,     2.68834,     2.70406,     2.70507,     2.71713,     2.73909,      2.7446,     2.75845,     2.77101,     2.78364,     2.81837,     2.82171,     2.84466,     2.85248,     2.87106,     2.87493,     2.88857,     2.89259,     2.93663,     2.93974,     2.96615,      3.0424,     3.04471,     3.05048,     3.06445,      3.0773,      3.0832,     3.09845,     3.12045,     3.12588,     3.13058,     3.13407,      3.1741,     3.17598,     3.23076,     3.24275,     3.29244,     3.29389,     3.29567,     3.31319,     3.34685,     3.34928,     3.39731,     3.39861,     3.41085,     3.41374,     3.43186,     3.44141,     3.46366,     3.46937,     3.47481,     3.47684,     3.47721,     3.51872,     3.52317,     3.52452,     3.53748,       3.562,     3.58168,     3.58215,     3.58937,     3.61414,     3.61423,      3.6276,     3.64515,     3.64858,     3.70315,     3.71353,     3.72733,     3.73159,     3.77302,     3.78242,     3.79039,     3.79499,     3.80655,     3.84999,      3.8542,     3.86456,     3.87655,      3.8943,     3.90002,     3.90551,     3.96947,     4.01817,      4.0589,     4.06009,     4.10503,     4.10761,     4.11324,     4.12647,     4.15569,     4.17052,      4.1862,      4.2086,     4.21201,     4.21368,     4.23465,     4.26531,     4.29483,     4.30256,      4.3108,     4.32033,     4.34769,     4.36748,     4.37218,     4.37688,     4.39826,     4.40807,     4.42648,     4.43631,     4.46927,     4.47302,     4.48184,     4.49308,     4.49952,     4.56867,     4.58296,     4.58629,     4.58832,     4.59691,     4.60569,     4.64977,     4.72226,     4.73119,     4.73477,     4.73478,     4.76766,     4.77263,     4.78815,     4.79354,     4.82377,      4.8344,     4.83651,     4.85336,     4.87636,     4.88597,     4.90407,     4.93855,       4.985,     4.98785,     4.99602,     5.03824,     5.13013,     5.20204,     5.22966,     5.23228,     5.25459,     5.26503,     5.28752,     5.31382,     5.31784,     5.33988,     5.34452,     5.34705,      5.3474,     5.37609,     5.39065,     5.39745,     5.39802,     5.40369,     5.40565,     5.43897,     5.44831,      5.4551,     5.45835,     5.46071,     5.47414,     5.50513,     5.53233,     5.55453,     5.55762,     5.57974,     5.59659,     5.65495,     5.67459,     5.67936,     5.69168,     5.75229,     5.75509,     5.79327,     5.79915,     5.81246,     5.81815,     5.82396,     5.83314,     5.85182,     5.92272,     5.95555,     5.95926,     6.04328,     6.05718,     6.08544,     6.09332,     6.09937,     6.11878,     6.13723,     6.16356,     6.17486,     6.21257,     6.22535,     6.27619,     6.30264,     6.32953,     6.34526,     6.35404,      6.3691,     6.37264,     6.38967,     6.39192,     6.41599,     6.43132,     6.43733,     6.44486,     6.46459,      6.5047,     6.54856,     6.56172,     6.57182,     6.57414,     6.59228,     6.59525,     6.61927,     6.65404,     6.66793,     6.71531,     6.77618,     6.77908,     6.79729,     6.80273,     6.80534,     6.80898,     6.81005,      6.8196,     6.83452,     6.84264,      6.8848,     6.89193,     6.95349,     6.96983,     6.97065,     6.99739,     6.99808,     7.04784,     7.08828,     7.09666,     7.14839,     7.14901,     7.15597,     7.15983,     7.17704,     7.19397,      7.1966,     7.20956,     7.22565,     7.23283,     7.25757,     7.33553,     7.35616,     7.44362,     7.46708,     7.48188,     7.55455,     7.71724,     7.72987,     7.75686,     7.77135,     7.82495,     7.84758,     7.91419,     7.92361,      7.9432,     8.00817,     8.04215,      8.1611,     8.18976,     8.19038,     8.22853,     8.25659,     8.27818,     8.34075,     8.44245,     8.45285,     8.54973,     8.57617,     8.65063,      8.6857,     8.73962,     8.76637,     8.76722,     8.80548,        8.81,      8.8444,     8.90529,     8.93048,     8.98378,     9.00367,     9.03157,     9.08987,     9.36705,     9.55647,     9.58129,     9.59625,     9.63837,     9.66233,     9.74243,     9.84584,     9.89692,     9.93431,     9.94585,     9.98633,     10.0268,     10.1145,     10.2426,      10.387,      10.437,      10.507,     10.5187,     10.6026,     10.6321,     10.6952,     10.8002,     10.8161,     10.9388,     10.9954,     11.0873,     11.1971,     11.2045,     11.2527,     11.3199,     11.6764,     11.7221,     11.7836,     11.9677,     11.9935,     12.0219,     12.2182,     12.2296,     12.3067,     12.4206,     12.5868,     12.6345,     12.7184,     12.7875,     12.9541,     13.4193,      13.448,      13.498,     13.5298,     13.9544,     14.0277,     14.0711,     14.0783,     14.1616,     14.4822,     14.8031,     14.9562,     14.9709,     15.0111,      15.514,     15.6766 };
//     std::vector<TF> dp{ -53.2264,    -52.5256,    -51.8248,     -51.124,    -50.4232,    -49.7225,    -49.0217,    -48.3209,    -47.6201,    -46.9193,    -46.2186,    -45.5178,     -44.817,    -44.1162,    -43.4154,    -42.7146,    -42.0139,    -41.3131,    -40.6123,    -39.9115,    -39.2107,      -38.51,    -37.8092,    -37.1084,    -36.4076,    -35.7068,    -35.0061,    -34.3053,    -33.6045,    -32.9037,    -32.2029,    -31.5021,    -30.8014,    -30.1006,    -29.3998,     -28.699,    -27.9982,    -27.2975,    -26.5967,    -25.8959,    -25.1951,    -24.4943,    -23.7935,    -23.0928,     -22.392,    -21.6912,    -20.9904,    -20.2896,    -19.5889,    -18.8881,    -18.1873,    -17.4865,    -16.7857,    -16.0849,    -15.3842,    -14.6834,    -13.9826,    -13.2818,     -12.581,    -11.8803,    -11.1795,    -10.4787,    -9.77792,    -9.07713,    -8.37635,    -7.67557,    -6.97479,    -6.27401,    -5.57323,    -4.87244,    -4.17166,    -3.47088,     -2.7701,    -2.06932,    -1.36854,   -0.667755,   0.0330268,    0.733808,     1.43459,     2.13537,     2.83615,     3.53693,     4.23772,      4.9385,     5.63928,     6.34006,     7.04084,     7.74162,     8.44241,     9.14319,     9.84397,     10.5448,     11.2455,     11.9463,     12.6471,     13.3479,     14.0487,     14.7494,     15.4502,      16.151 };
//     std::vector<TF> dv{ 0.00111396,  0.00516993,  0.00798339,   0.0064267,   0.0061982,  0.00659808,  0.00672662,  0.00721219,  0.00746926,   0.0085975,  0.00916876,  0.00885457,  0.00931158,  0.00911164,  0.00948296,   0.0106826,    0.011668,    0.012682,   0.0119251,   0.0118823,   0.0120822,    0.011968,    0.012782,   0.0126249,   0.0133104,    0.015624,    0.016181,    0.016738,   0.0164666,   0.0179234,   0.0176806,   0.0199799,   0.0237074,   0.0241358,    0.021251,   0.0194658,   0.0192515,   0.0182804,   0.0183518,    0.018666,   0.0187517,   0.0186803,   0.0191373,   0.0224363,   0.0239502,   0.0267351,   0.0283632,   0.0270207,   0.0244786,   0.0232075,   0.0210653,   0.0208796,   0.0194943,   0.0174235,   0.0154241,   0.0159382,   0.0149814,     0.01481,    0.015167,   0.0143387,   0.0134104,   0.0121679,   0.0123964,   0.0122821,   0.0125535,    0.012125,   0.0122393,   0.0124392,   0.0125535,   0.0131819,   0.0195657,   0.0253926,   0.0289202,   0.0247642,   0.0238359,   0.0238359,   0.0218079,   0.0204084,   0.0201513,   0.0208082,   0.0200942,   0.0201941,   0.0151527,   0.0138531,   0.0120251,  0.00998281,   0.0102684,  0.00908307,  0.00796911,  0.00528418,  0.00502711,  0.00475576,  0.00447013,  0.00405596,  0.00339901,  0.00287059,  0.00241358,  0.00218508,  0.00197086,   0.0012425 };

//     // glot_vec_ys( dv );
        
//     DiffusionDensity<TF> gd( dp, dv );

//     // glot_stream( [&]( std::ostream &fs ) {
//     //     for ( TF r : linspace<TF>( 0, 1, 10 ) ) {
//     //         gd.set_flattening_ratio( r );
//     //         gd.plot( fs, r == 0 ? "-" : "--", r == 0 || r == 1 ? 2 : 1 );
//     //     }
//     // } );

//     System<TF> si;
//     si.set_global_mass_ratio( 0.984 );
//     si.set_dirac_positions( pd );
//     si.set_density( &gd );

//     si.stream = &std::cout;
//     si.verbosity = 2;

//     si.solve();
//     // si.plot();
// }

TEST_CASE( "System", "" ) {
    DiffusionDensity<TF> gd( linspace<TF>( 10, 11, 3 ), std::vector<TF>{ 1, 1, 1 } );
    auto diracs = cellspace<TF>( 0.0, 1.0, 10 );

    System<TF> si;
    si.target_newton_error = 1e-40;
    si.set_dirac_positions( diracs );
    si.set_global_mass_ratio( 0.1 );
    si.set_density( &gd );

    si.stream = &std::cout;
    si.verbosity = 2;
    si.solve();
    si.plot();

    std::vector<TF> f_grad( si.nb_original_diracs() );
    for( PI i = 0; i < f_grad.size(); ++i )
        f_grad[ i ] = 2 * si.global_mass_ratio / si.nb_original_diracs() * ( si.dirac_positions()[ i ] - si.cell_barycenters()[ i ] );
       

    const TF eps = 1e-20;
    const TF cost_ref = pow( si.cost(), 2 );
    for( PI i = 0; i < si.nb_original_diracs(); ++i ) {
        auto ov = diracs[ i ];
        diracs[ i ] += eps;

        System<TF> si;
        si.target_newton_error = 1e-40;
        si.set_dirac_positions( diracs );
        si.set_global_mass_ratio( 0.1 );
        si.set_density( &gd );
        si.solve();

        P( ( pow( si.cost(), 2 ) - cost_ref ) / eps - f_grad[ i ] );

        diracs[ i ] = ov;
    }
        

    // si.plot();
}
